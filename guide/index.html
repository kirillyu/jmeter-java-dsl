<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>User guide | jmeter-java-dsl</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" href="/jmeter-java-dsl/favicon.ico">
    <meta name="description" content="Simple JMeter performance tests API">
    <meta name="theme-color" content="#00ace6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/jmeter-java-dsl/assets/css/0.styles.6cfd7338.css" as="style"><link rel="preload" href="/jmeter-java-dsl/assets/js/app.a80c093b.js" as="script"><link rel="preload" href="/jmeter-java-dsl/assets/js/2.116f2a4a.js" as="script"><link rel="preload" href="/jmeter-java-dsl/assets/js/4.cafc48df.js" as="script"><link rel="preload" href="/jmeter-java-dsl/assets/js/3.c35124cc.js" as="script"><link rel="prefetch" href="/jmeter-java-dsl/assets/js/10.d3659097.js"><link rel="prefetch" href="/jmeter-java-dsl/assets/js/5.2cb8fecd.js"><link rel="prefetch" href="/jmeter-java-dsl/assets/js/6.710950de.js"><link rel="prefetch" href="/jmeter-java-dsl/assets/js/7.51f5df6c.js"><link rel="prefetch" href="/jmeter-java-dsl/assets/js/8.540808c0.js"><link rel="prefetch" href="/jmeter-java-dsl/assets/js/9.8991965e.js">
    <link rel="stylesheet" href="/jmeter-java-dsl/assets/css/0.styles.6cfd7338.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jmeter-java-dsl/" class="home-link router-link-active"><img src="/jmeter-java-dsl/logo.svg" alt="jmeter-java-dsl" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/jmeter-java-dsl/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/jmeter-java-dsl/motivation/" class="nav-link">
  Motivation
</a></div> <a href="https://github.com/abstracta/jmeter-java-dsl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/jmeter-java-dsl/guide/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/jmeter-java-dsl/motivation/" class="nav-link">
  Motivation
</a></div> <a href="https://github.com/abstracta/jmeter-java-dsl" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>User guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/jmeter-java-dsl/guide/#setup" class="sidebar-link">Setup</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/jmeter-java-dsl/guide/#simple-http-test-plan" class="sidebar-link">Simple HTTP test plan</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/jmeter-java-dsl/guide/#run-test-at-scale" class="sidebar-link">Run test at scale</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#blazemeter" class="sidebar-link">BlazeMeter</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#jmeter-remote-testing" class="sidebar-link">JMeter Remote Testing</a></li></ul></li><li><a href="/jmeter-java-dsl/guide/#advanced-threads-configuration" class="sidebar-link">Advanced threads configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#thread-ramps-and-holds" class="sidebar-link">Thread ramps and holds</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#throughput-based-thread-group" class="sidebar-link">Throughput based thread group</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#set-up-tear-down" class="sidebar-link">Set Up &amp; Tear Down</a></li></ul></li><li><a href="/jmeter-java-dsl/guide/#test-plan-debugging" class="sidebar-link">Test plan debugging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#view-results-tree" class="sidebar-link">View Results Tree</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#post-processor-breakpoints" class="sidebar-link">Post processor breakpoints</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#debug-jmeter-code" class="sidebar-link">Debug JMeter code</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#debug-groovy-code" class="sidebar-link">Debug Groovy code</a></li></ul></li><li><a href="/jmeter-java-dsl/guide/#reporting" class="sidebar-link">Reporting</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#log-requests-and-responses" class="sidebar-link">Log requests and responses</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#real-time-metrics-visualization-and-historic-data-storage" class="sidebar-link">Real-time metrics visualization and historic data storage</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#influxdb" class="sidebar-link" style="padding-left:3rem;">InfluxDB</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#elasticsearch" class="sidebar-link" style="padding-left:3rem;">Elasticsearch</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#generate-html-reports-from-test-plan-execution" class="sidebar-link">Generate HTML reports from test plan execution</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#live-built-in-graphs-and-stats" class="sidebar-link">Live built-in graphs and stats</a></li></ul></li><li><a href="/jmeter-java-dsl/guide/#response-processing" class="sidebar-link">Response Processing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#check-for-expected-response" class="sidebar-link">Check for expected response</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#change-sample-result-statuses-with-custom-logic" class="sidebar-link">Change sample result statuses with custom logic</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#use-part-of-a-response-in-a-following-request-aka-correlation" class="sidebar-link">Use part of a response in a following request (aka: correlation)</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#regular-expression-extractor" class="sidebar-link" style="padding-left:3rem;">Regular Expression Extractor</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#boundary-extractors" class="sidebar-link" style="padding-left:3rem;">Boundary Extractors</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#json-extractor" class="sidebar-link" style="padding-left:3rem;">JSON Extractor</a></li></ul></li><li><a href="/jmeter-java-dsl/guide/#requests-generation" class="sidebar-link">Requests generation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#conditionals" class="sidebar-link">Conditionals</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#loops" class="sidebar-link">Loops</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#while-controller" class="sidebar-link" style="padding-left:3rem;">While Controller</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#for-loop-controller" class="sidebar-link" style="padding-left:3rem;">For Loop Controller</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#provide-request-parameters-programmatically-per-request" class="sidebar-link">Provide Request Parameters Programmatically per Request</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#csv-as-input-data-for-requests" class="sidebar-link">CSV as input data for requests</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#group-requests" class="sidebar-link">Group requests</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#emulate-user-delays-between-requests" class="sidebar-link">Emulate user delays between requests</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#execute-test-plan-part-for-a-fraction-of-times" class="sidebar-link">Execute test plan part for a fraction of times</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#parallel-requests" class="sidebar-link">Parallel requests</a></li></ul></li><li><a href="/jmeter-java-dsl/guide/#protocols" class="sidebar-link">Protocols</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#http-performance-testing" class="sidebar-link">HTTP performance testing</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#methods-body" class="sidebar-link" style="padding-left:3rem;">Methods &amp; body</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#headers" class="sidebar-link" style="padding-left:3rem;">Headers</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#cookies-caching" class="sidebar-link" style="padding-left:3rem;">Cookies &amp; Caching</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#embedded-resources" class="sidebar-link" style="padding-left:3rem;">Embedded resources</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#redirects" class="sidebar-link" style="padding-left:3rem;">Redirects</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#java-api-performance-testing" class="sidebar-link">Java API performance testing</a></li></ul></li><li><a href="/jmeter-java-dsl/guide/#jmx-support" class="sidebar-link">JMX support</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#save-as-jmx" class="sidebar-link">Save as JMX</a></li><li class="sidebar-sub-header"><a href="/jmeter-java-dsl/guide/#run-jmx-file" class="sidebar-link">Run JMX file</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="user-guide"><a href="#user-guide" class="header-anchor">#</a> User guide</h1> <p>Here we share some tips and examples on how to use the DSL to tackle common use cases.</p> <p>Provided examples use <a href="https://junit.org/junit5/" target="_blank" rel="noopener noreferrer">JUnit 5<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://joel-costigliola.github.io/assertj/assertj-core-quick-start.html" target="_blank" rel="noopener noreferrer">AssertJ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, but you can use other test &amp; assertion libraries.</p> <p>Explore the DSL in your preferred IDE to discover all available features, and consider reviewing <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/test/java/us/abstracta/jmeter/javadsl" target="_blank" rel="noopener noreferrer">existing tests<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional examples.</p> <p>The DSL currently supports most common used cases, keeping it simple and avoiding investing development effort in features that might not be needed. If you identify any particular scenario (or JMeter feature) that you need and is not currently supported, or easy to use, <strong>please let us know by <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">creating an issue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> and we will try to implement it as soon as possible. Usually porting JMeter features is quite fast.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you like this project, <strong>please give it a star ‚≠ê in <a href="https://github.com/abstracta/jmeter-java-dsl" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>!</strong> This helps the project be more visible, gain relevance and encourages us to invest more effort in new features.</p></div> <p>For an intro to JMeter concepts and components you can check <a href="http://jmeter.apache.org/usermanual/get-started.html" target="_blank" rel="noopener noreferrer">JMeter official documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="setup"><a href="#setup" class="header-anchor">#</a> Setup</h2> <p>To use the DSL just include it in your project:</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code><span class="token comment">// this is required due to JMeter open issue: https://bz.apache.org/bugzilla/show_bug.cgi?id=64465</span>
<span class="token annotation punctuation">@CacheableRule</span>
<span class="token keyword">class</span> <span class="token class-name">JmeterRule</span> <span class="token keyword">implements</span> <span class="token class-name">ComponentMetadataRule</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span>ComponentMetadataContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span>details<span class="token punctuation">.</span>allVariants <span class="token punctuation">{</span>
            withDependencies <span class="token punctuation">{</span>
                removeAll <span class="token punctuation">{</span> it<span class="token punctuation">.</span>group <span class="token operator">==</span> <span class="token string gstring">&quot;org.apache.jmeter&quot;</span> <span class="token operator">&amp;&amp;</span> it<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string gstring">&quot;bom&quot;</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token punctuation">...</span>
    testImplementation <span class="token string">'us.abstracta.jmeter:jmeter-java-dsl:0.33'</span>
    components <span class="token punctuation">{</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:ApacheJMeter_core&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:ApacheJMeter_java&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:ApacheJMeter&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:ApacheJMeter_http&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:ApacheJMeter_functions&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:ApacheJMeter_components&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:ApacheJMeter_config&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
        <span class="token function">withModule</span><span class="token punctuation">(</span><span class="token string gstring">&quot;org.apache.jmeter:jorphan&quot;</span><span class="token punctuation">,</span> JmeterRule<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div></div></div> <h2 id="simple-http-test-plan"><a href="#simple-http-test-plan" class="header-anchor">#</a> Simple HTTP test plan</h2> <p>To generate HTTP requests just use provided <code>httpSampler</code>.</p> <p>Following example uses 2 threads (concurrent users) which send 10 HTTP GET requests each to <code>http://my.service</code>.</p> <p>Additionally, it logs collected statistics (response times, status codes, etc.) to a timestamped file (for later analysis if needed) and checks that the response time 99 percentile is less than 5 seconds.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">//this is just to log details of each request stats</span>
      <span class="token function">jtlWriter</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span> <span class="token operator">+</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.jtl&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When working with multiple samplers in a test plan, specify their names to easily check their respective statistics.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Since JMeter uses <a href="https://logging.apache.org/log4j/2.x/" target="_blank" rel="noopener noreferrer">log4j2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, if you want to control logging level or output, you can use something similar to this <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/test/resources/log4j2.xml" target="_blank" rel="noopener noreferrer">log4j2.xml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Keep in mind that you can use Java programming to modularize and create abstractions which allow you to build complex test plans that are still easy to read, use and maintain. <a href="https://github.com/abstracta/jmeter-java-dsl/issues/26#issuecomment-953783407" target="_blank" rel="noopener noreferrer">Here is an example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> of some complex abstraction built using Java features and the DSL.</p></div> <p>Check <a href="#http-performance-testing">HTTP performance testing</a> for additional details while testing HTTP services.</p> <h2 id="run-test-at-scale"><a href="#run-test-at-scale" class="header-anchor">#</a> Run test at scale</h2> <p>Running a load test from one machine is not always enough, since you are limited to the machine hardware capabilities. Sometimes, is necessary to run the test using a cluster of machines to be able to generate enough load for the system under test.</p> <h3 id="blazemeter"><a href="#blazemeter" class="header-anchor">#</a> BlazeMeter</h3> <p>By including following module as dependency:</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-blazemeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>testImplementation <span class="token string">'us.abstracta.jmeter:jmeter-java-dsl-blazemeter:0.33'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div></div> <p>You can easily run a JMeter test plan at scale in <a href="https://www.blazemeter.com/" target="_blank" rel="noopener noreferrer">BlazeMeter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>blazemeter<span class="token punctuation">.</span></span><span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token comment">// number of threads and iterations are in the end overwritten by BlazeMeter engine settings </span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlazeMeterEngine</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;BZ_TOKEN&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">testName</span><span class="token punctuation">(</span><span class="token string">&quot;DSL test&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">totalUsers</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">holdFor</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">threadsPerEngine</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">testTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><blockquote><p>This test is using <code>BZ_TOKEN</code>, a custom environment variable with <code>&lt;KEY_ID&gt;:&lt;KEY_SECRET&gt;</code> format, to get the BlazeMeter API authentication credentials.</p></blockquote> <p>Note that is as simple as <a href="https://guide.blazemeter.com/hc/en-us/articles/115002213289-BlazeMeter-API-keys-" target="_blank" rel="noopener noreferrer">generating a BlazeMeter authentication token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and adding <code>.runIn(new BlazeMeterEngine(...))</code> to any existing jmeter-java-dsl test to get it running at scale in BlazeMeter.</p> <p>BlazeMeter will not only allow you to run the test at scale but also provides additional features like the nice real time reporting, historic data tracking, etc. Here is an example of how a test would look like in BlazeMeter:</p> <p><img src="/jmeter-java-dsl/assets/img/blazemeter.43bbae4d.png" alt="blazemeter.png"></p> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-blazemeter/src/main/java/us/abstracta/jmeter/javadsl/blazemeter/BlazeMeterEngine.java" target="_blank" rel="noopener noreferrer">BlazeMeterEngine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details on usage and available settings when running tests in BlazeMeter.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>In case you want to get debug logs for HTTP calls to BlazeMeter API, you can include following setting to an existing <code>log4j2.xml</code> configuration file:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>us.abstracta.jmeter.javadsl.blazemeter.BlazeMeterClient<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>okhttp3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If you use JSR223 Pre- or Post- processors with Java code (lambdas) instead of strings (<a href="#change-sample-result-statuses-with-custom-logic">here</a> are some examples), or use one of the HTTP Sampler methods which receive a function as parameter (as in <a href="#provide-request-parameters-programmatically-per-request">here</a>), then BlazeMeter execution won't work. You can migrate them to use <code>jsrPreProcessor</code> with string scripts instead. Check associated methods documentation for more details.</p></div> <h3 id="jmeter-remote-testing"><a href="#jmeter-remote-testing" class="header-anchor">#</a> JMeter Remote Testing</h3> <p>JMeter already provides means to run a test on several machines controlled by one master/client machine. This is refered as <a href="http://jmeter.apache.org/usermanual/remote-test.html" target="_blank" rel="noopener noreferrer">Remote Testing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>JMeter remote testing requires to setup nodes in server/slave mode (using <code>bin/jmeter-server</code> JMeter script) with a configured keystore (usually <code>rmi_keystore.jks</code>, generated with <code>bin/</code> JMeter script) which will execute a test plan triggered in a client/master node.</p> <p>You can trigger such tests with the DSL using <code>DistributedJmeterEngine</code> as in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engines<span class="token punctuation">.</span></span><span class="token class-name">DistributedJmeterEngine</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runIn</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DistributedJmeterEngine</span><span class="token punctuation">(</span><span class="token string">&quot;host1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;host2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>This will run 200 users for 10 minutes on each server/slave (<code>host1</code> and <code>host2</code>) and aggregate all the results in returned stats.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>To be able to run the test you require the <code>rmi_keystore.jks</code> file in working directory of the test. For the time being we couldn't find a way to allow setting any arbitrary path for the file.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>In general, prefer using BlazeMeter option which avoids all the setup and maintenance costs of the infrastructure required by JMeter remote testing, in addition to additional useful features (like reporting capabilities).</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/engines/DistributedJmeterEngine.java" target="_blank" rel="noopener noreferrer">DistributedJmeterEngine<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="http://jmeter.apache.org/usermanual/remote-test.html" target="_blank" rel="noopener noreferrer">JMeter documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for proper setup and additional options.</p> <h2 id="advanced-threads-configuration"><a href="#advanced-threads-configuration" class="header-anchor">#</a> Advanced threads configuration</h2> <p>jmeter-java-dsl provides two simple ways of creating thread groups which are used in most scenarios:</p> <ul><li>specifying threads and number of iterations each thread should execute before ending test plan</li> <li>specifying threads and duration for which each thread should execute before test plan ends</li></ul> <p>This is how they look in code:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// 10 threads for 20 iterations each</span>
<span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 10 threads for 20 seconds each</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>But these options are not good when working with many threads or when trying to configure some complex test scenarios (like when doing incremental or peak tests).</p> <h3 id="thread-ramps-and-holds"><a href="#thread-ramps-and-holds" class="header-anchor">#</a> Thread ramps and holds</h3> <p>When working with many threads, it is advisable to configure a ramp up period, to avoid starting all threads at once affecting performance metrics and generation.</p> <p>You can easily configure a ramp up with the DSL like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">holdIterating</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// ramp to 10 threads for 5 seconds (1 thread every half second) and iterating each thread 20 times</span>
<span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//similar as above but after ramping up holding execution for 20 seconds</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Additionally, you can use and combine these same methods to configure more complex scenarios (incremental, peak, and any other types of tests) like the following one:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Which would translate in the following threads' timeline:</p> <p><img src="/jmeter-java-dsl/assets/img/ultimate-thread-group-timeline.83d20eb4.png" alt="Thread Group Timeline"></p> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/DslThreadGroup.java" target="_blank" rel="noopener noreferrer">DslThreadGroup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>To visualize threads timeline, for complex thread group configurations like previous one, you can get a chart like previous one by using provided <code>DslThreadGroup.showTimeline()</code> method.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you are a JMeter GUI user, you may even be interested in using provided <code>TestElement.showInGui()</code> method, which shows the JMeter test element GUI that could help you understand what will DSL execute in JMeter. You can use this method with any test element generated by the DSL (not just thread groups).</p> <p>For example, for above test plan you would get a window like the following one:</p> <p><img src="/jmeter-java-dsl/assets/img/ultimate-thread-group-gui.0c30a3b6.png" alt="UltimateThreadGroup GUI"></p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When using multiple thread groups in a test plan, consider setting a name on them to properly identify associated requests in statistics &amp; jtl results.</p></div> <h3 id="throughput-based-thread-group"><a href="#throughput-based-thread-group" class="header-anchor">#</a> Throughput based thread group</h3> <p>Sometimes you want to focus just on the number of requests per second to generate and don't want to be concerned about how many concurrent threads/users, and pauses between requests, are needed. For these scenarios you can use <code>rpsThreadGroup</code> like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">rpsThreadGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">maxThreads</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This will internally use JMeter <a href="https://jmeter-plugins.org/wiki/ConcurrencyThreadGroup/" target="_blank" rel="noopener noreferrer">Concurrency Thread Group<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> element in combination with <a href="https://jmeter-plugins.org/wiki/ThroughputShapingTimer/" target="_blank" rel="noopener noreferrer">Throughput Shaping Time<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>rpsThreadGroup</code> will dynamically create and remove threads and add delays between requests to match the traffic to the expected RPS. You can also specify to control iterations per second (number of times the flow in the thread group runs per second) instead of threads by using <code>.counting(RpsThreadGroup.EventType.ITERATIONS)</code>.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>RPS values control how often to adjust threads and waits. Avoid too low (eg: under 1) values which can cause big waits and don't match expected RPS.</p> <p>JMeter Throughput Shaping Timer calculates each time the delay to be used not taking into consideration future expected RPS.
For instance, if you configure 1 thread with ramp from 0.01 to 10 RPS with 10 seconds duration, when 1 request is sent it will calculate that to
match 0.01 RPS has to wait <code>requestsCount/expectedRPS = 1/0.01 = 100</code> seconds, which would keep the thread stuck for 100 seconds when in fact should have done two additional requests after waiting 1 second (to match the ramp).
Setting this value greater or equal to 1 will assure at least 1 evaluation every second.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>When no <code>maxThreads</code> are specified, <code>rpsThreadGroup</code> will use as many threads as needed. In such scenarios, you might end with unexpected number of threads with associated CPU and Memory requirements, which may affect the performance test metrics. <strong>You should always set maximum threads to use</strong> to avoid such scenarios.</p> <p>You can use following formula to calculate a value for <code>maxThreads</code>: <code>T*R</code>, being <code>T</code> the maximum RPS that you want to achieve and <code>R</code> the maximum expected response time (or iteration time if you use <code>.counting(RpsThreadGroup.EventType.ITERATIONS)</code>) in seconds.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>As with default thread group, with <code>rpsThreadGroup</code> you can use <code>showTimeline</code> to get a chart of configured RPS profile for easy visualization. An example chart:</p> <p><img src="/jmeter-java-dsl/assets/img/rps-thread-group-timeline.f07812d8.png" alt="RPS Thread Group Timeline"></p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/RpsThreadGroup.java" target="_blank" rel="noopener noreferrer">RpsThreadGroup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <h3 id="set-up-tear-down"><a href="#set-up-tear-down" class="header-anchor">#</a> Set Up &amp; Tear Down</h3> <p>When you need to run some custom logic before or after a test plan, the simplest approach is just adding plain java code to it, or using your test framework (eg: JUnit) provided features for this purpose. Eg:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">AfterEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>
  
  <span class="token annotation punctuation">@BeforeEach</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// my custom setup logic</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@AfterEach</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// my custom setup logic</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>But, in some cases you may need the logic to run inside the JMeter execution context (eg: set some JMeter properties), or, when test plan runs at scale, to run in same host where the test plan runs (for example to use some common file).</p> <p>In such scenarios you can use provided <code>setupThreadGroup</code> &amp; <code>teardownThreadGroup</code> like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpMethod</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">setupThreadGroup</span><span class="token punctuation">(</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/tokens&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                    <span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span><span class="token string">&quot;props.put('MY_TEST_TOKEN', prev.responseDataAsString)&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/products&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-MY-TOKEN&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;${__P(MY_TEST_TOKEN)}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">teardownThreadGroup</span><span class="token punctuation">(</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/tokens/${__P(MY_TEST_TOKEN)}&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>DELETE<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/DslSetupThreadGroup.java" target="_blank" rel="noopener noreferrer">DslSetupThreadGroup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/threadgroups/DslTeardownThreadGroup.java" target="_blank" rel="noopener noreferrer">DslTeardownThreadGroup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional tips and details on the usage of these components.</p> <h2 id="test-plan-debugging"><a href="#test-plan-debugging" class="header-anchor">#</a> Test plan debugging</h2> <p>A usual requirement while building a test plan is to be able to debug for potential issues in configuration or behavior of service under test. With jmeter-java-dsl you have several options for this purpose.</p> <h3 id="view-results-tree"><a href="#view-results-tree" class="header-anchor">#</a> View Results Tree</h3> <p>One option is using provided <code>resultsTreeVisualizer()</code> like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">resultsTreeVisualizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>This will display the JMeter built-in View Results Tree element, which allows you to review request and response contents in addition to collected metrics (spent time, sent &amp; received bytes, etc.) for each request sent to server, in a window like this one:</p> <p><img src="/jmeter-java-dsl/assets/img/view-results-tree.53c75345.png" alt="View Results Tree"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>To debug test plans use few iterations and threads to reduce the execution time and ease tracing by having less information to analyze.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When adding <code>resultsTreeVisualizer()</code> as child of a thread group, it will only display sample results of that thread group. When added as child of a sampler, it will only show sample results for that sampler. You can use this to only review certain sample results in your test plan.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>Remove <code>resultsTreeVisualizer()</code> from test plans when are no longer needed</strong> (when debugging is finished). Leaving them might interfere with unattended test plan execution due to test plan execution not finishing until all visualizers windows are closed.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>By default, View Results Tree only display last 500 sample results. If you need to display more elements, use provided <code>resultsLimit(int)</code> method which allows changing this value. Take into consideration that the more results are shown, the more memory that will require. So use this setting with care.</p></div> <h3 id="post-processor-breakpoints"><a href="#post-processor-breakpoints" class="header-anchor">#</a> Post processor breakpoints</h3> <p>Another alternative is using IDE builtin debugger by adding a <code>jsr223PostProcessor</code> with java code and adding a breakpoint to the post processor code. This does not only allow checking sample result information but also JMeter variables and properties values and sampler properties.</p> <p>Here is an example screenshot using this approach while debugging with an IDE:</p> <p><img src="/jmeter-java-dsl/assets/img/post-processor-debugging.48f761c7.png" alt="Post Processor Debugging"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>DSL provides following methods to ease results and variables visualization and debugging: <code>varsMap()</code>, <code>prevMap()</code>, <code>prevMetadata()</code>, <code>prevMetrics()</code>, <code>prevRequest()</code>, <code>prevResponse()</code>. Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslJsr223PostProcessor.java" target="_blank" rel="noopener noreferrer">PostProcessorVars<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/DslJsr223TestElement.java" target="_blank" rel="noopener noreferrer">Jsr223ScriptVars<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Remove such post processors when no longer needed (when debugging is finished). Leaving them would generate errors when loading generated JMX test plan or running test plan in BlazeMeter, in addition to unnecessary processing time and resource usage.</p></div> <h3 id="debug-jmeter-code"><a href="#debug-jmeter-code" class="header-anchor">#</a> Debug JMeter code</h3> <p>You can even add break points to JMeter code in your IDE and debug the code line by line providing the greatest possible detail.</p> <p>Here is an example screenshot debugging HTTP Sampler:</p> <p><img src="/jmeter-java-dsl/assets/img/jmeter-http-sampler-debugging.3b564607.png" alt="JMeter HTTP Sampler Debugging"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>JMeter class in charge of executing threads logic is <code>org.apache.jmeter.threads.JMeterThread</code>. You can check classes used by each DSL provided test element by checking the DSL code.</p></div> <h3 id="debug-groovy-code"><a href="#debug-groovy-code" class="header-anchor">#</a> Debug Groovy code</h3> <p>In some cases you may want to debug some Groovy script used in some sampler, pre- or post-processor. For such scenarios you can check <a href="https://github.com/abstracta/jmeter-java-dsl/issues/41#issuecomment-966715062" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> where we list some options.</p> <h2 id="reporting"><a href="#reporting" class="header-anchor">#</a> Reporting</h2> <p>Once you have a test plan you would usually want to be able to analyze collected information. In this section we show you several ways to achieve this.</p> <h3 id="log-requests-and-responses"><a href="#log-requests-and-responses" class="header-anchor">#</a> Log requests and responses</h3> <p>The main mechanism provided by JMeter (and jmeter-java-dsl) to get information about generated requests, responses and associated metrics is through the generation of JTL files.</p> <p>This can be easily achieved in jmeter-java-dsl by using provided <code>jtlWriter</code> like in this example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">jtlWriter</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span> <span class="token operator">+</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.jtl&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>By default, <code>jtlWriter</code> will write most used information to evaluate performance of tested service. If you want to trace all the information of each request you may use <code>jtlWriter</code> with <code>withAllFields(true)</code> option. Doing this will provide all the information at the cost of additional computation and resources usage (less resources for actual load testing). You can tune which fields to include or not with <code>jtlWriter</code> and only log what you need, check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/listeners/JtlWriter.java" target="_blank" rel="noopener noreferrer">JtlWriter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <p>An additional option, specially targeted towards logging sample responses, is <code>responseFileSaver</code> which automatically generates a file for each received response. Here is an example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
 
 <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>
 
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>
 
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
     <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
       <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
         <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
       <span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token function">responseFileSaver</span><span class="token punctuation">(</span><span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-response&quot;</span><span class="token punctuation">)</span>
     <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/listeners/ResponseFileSaver.java" target="_blank" rel="noopener noreferrer">ResponseFileSaver<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <p>Finally, if you have more specific needs that are not covered by previous examples, you can use <code>jsr223PostProcessor</code> to define you own custom logic like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
 
 <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
 <span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>
 
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>
 
   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
     <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
       <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
         <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span><span class="token string">&quot;new File('traceFile') &lt;&lt; \&quot;${prev.sampleLabel}&gt;&gt;${prev.responseDataAsString}\\n\&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">)</span>
     <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslJsr223PostProcessor.java" target="_blank" rel="noopener noreferrer">DslJsr223PostProcessor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <h3 id="real-time-metrics-visualization-and-historic-data-storage"><a href="#real-time-metrics-visualization-and-historic-data-storage" class="header-anchor">#</a> Real-time metrics visualization and historic data storage</h3> <p>When running tests with JMeter (and in particular with jmeter-java-dsl) a usual requirement is to be able to store such test runs in a persistent database to later on review such metrics, and compare different test runs. Additionally, jmeter-java-dsl only provides some summary data of test run in the console while it is running, but, since it doesn't provide any sort of UI, doesn't allow to easily analyze such information as it can be done in JMeter GUI.</p> <p>To overcome these limitations you can use provided support for publishing JMeter test run metrics to <a href="https://www.influxdata.com/products/influxdb-overview/" target="_blank" rel="noopener noreferrer">InfluxDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://www.elastic.co/what-is/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which allows keeping record of all run statistics and, through <a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">Grafana<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, get some nice dashboards like the following one:</p> <p><img src="/jmeter-java-dsl/assets/img/grafana.66e8ded3.png" alt="grafana"></p> <h4 id="influxdb"><a href="#influxdb" class="header-anchor">#</a> InfluxDB</h4> <p>This can be easily done using <code>influxDbListener</code>, an existing InfluxDB &amp; Grafana server and using a dashboard like <a href="https://grafana.com/grafana/dashboards/4026" target="_blank" rel="noopener noreferrer">this one<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Here is an example test plan:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">influxDbListener</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8086/write?db=jmeter&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>If you want to try it locally you can run <code>docker-compose up</code> (previously <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">installing Docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in you machine) inside <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/influxdb" target="_blank" rel="noopener noreferrer">this directory<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. After containers are started, you can open Grafana at <a href="http://localhost:3000" target="_blank" rel="noopener noreferrer">http://localhost:3000<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Finally, run a performance test using the <code>influxDbListener</code> and you will be able to see the live results, and keep historic data. Cool, isn't it?!</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Use provided <code>docker-compose</code> settings for local tests only. It uses weak credentials and is not properly configured for production purposes.</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/listeners/InfluxDbBackendListener.java" target="_blank" rel="noopener noreferrer">InfluxDbBackendListener<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional details and settings.</p> <h4 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> Elasticsearch</h4> <p>Another alternative is using provided <code>jmeter-java-dsl-elasticsearch-listener</code> module with Elasticsearch and Grafana servers using a dashboard like <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/elasticsearch/grafana-provisioning/dashboards/jmeter.json" target="_blank" rel="noopener noreferrer">this one<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>To use the module, you will need to include following dependency in your project:</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-elasticsearch-listener<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><p>Add this repository:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>maven <span class="token punctuation">{</span> url <span class="token string">'https://jitpack.io'</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>And the dependency:</p> <div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>testImplementation <span class="token string">'us.abstracta.jmeter:jmeter-java-dsl-elasticsearch-listener:0.33'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div></div> <p>And use provided <code>elasticsearchListener()</code> method like in this example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>elasticsearch<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">ElasticsearchBackendListener</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">elasticsearchListener</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:9200/jmeter&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This module uses <a href="https://github.com/delirius325/jmeter-elasticsearch-backend-listener" target="_blank" rel="noopener noreferrer">this JMeter plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which, at its current version, has performance and dependency issues which might affect your project. <a href="https://github.com/delirius325/jmeter-elasticsearch-backend-listener/pull/109" target="_blank" rel="noopener noreferrer">This<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/delirius325/jmeter-elasticsearch-backend-listener/pull/110" target="_blank" rel="noopener noreferrer">this<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pull requests fix those issues, but until they are merged and released, you might face such issues.</p></div> <p>In same fashion as InfluxDB, if you want to try it locally, you can run <code>docker-compose up</code> inside <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/docs/guide/elasticsearch" target="_blank" rel="noopener noreferrer">this directory<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and follow similar steps <a href="#influxdb">as described for InfluxDB</a> to visualize live metrics in Grafana.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Use provided <code>docker-compose</code> settings for local tests only. It uses weak or no credentials and is not properly configured for production purposes.</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-elasticsearch-listener/src/main/java/us/abstracta/jmeter/javadsl/elasticsearch/listener/ElasticsearchBackendListener.java" target="_blank" rel="noopener noreferrer">ElasticsearchBackendListener<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional details and settings.</p> <h3 id="generate-html-reports-from-test-plan-execution"><a href="#generate-html-reports-from-test-plan-execution" class="header-anchor">#</a> Generate HTML reports from test plan execution</h3> <p>After running a test plan you would usually like to visualize the results in friendly way that eases analysis of collected information.</p> <p>One, and preferred way, to do that is through <a href="#real-time-metrics-visualization-and-historic-data-storage">previously mentioned alternative</a>.</p> <p>Another way, might just be using <a href="#simple-http-test-plan">previously introduced</a> <code>jtlWriter</code> and then loading the jtl file in JMeter GUI with one of JMeter provided listeners (like view results tree, summary report, etc.).</p> <p>Another alternative is generating a standalone report for the test plan execution using jmeter-java-dsl provided <code>htmlReporter</code> like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">htmlReporter</span><span class="token punctuation">(</span><span class="token string">&quot;html-report-&quot;</span> <span class="token operator">+</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>htmlReporter</code> will throw an exception if provided directory path is a nonempty directory or file</p></div> <h3 id="live-built-in-graphs-and-stats"><a href="#live-built-in-graphs-and-stats" class="header-anchor">#</a> Live built-in graphs and stats</h3> <p>Sometimes you want to get live statistics on the test plan and don't want to install additional tools, and are not concerned about keeping historic data.</p> <p>You can use <code>dashboardVisualizer</code> to get live charts and stats for quick review.</p> <p>To use it, you need to add following dependency:</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-dsl-dashboard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.33<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>testImplementation <span class="token string">'us.abstracta.jmeter:jmeter-java-dsl-dashboard:0.33'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div></div> <p>And use it as you would with any of previously mentioned listeners (like <code>influxDbListener</code> and <code>jtlWriter</code>).</p> <p>Here is an example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>dashboard<span class="token punctuation">.</span></span><span class="token class-name">DashboardVisualizer</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token string">&quot;Group1&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;Sample 1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token string">&quot;Group2&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">rampToAndHold</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;Sample 2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://my.service/get&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">dashboardVisualizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>The <code>dashboardVisualizer</code> will pop up a window like the following one, which you can use to trace statistics while the test plan runs:</p> <p><img src="/jmeter-java-dsl/assets/img/dashboard.1786796a.png" alt="dashboard"></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The dashboard imposes additional resources (CPU &amp; RAM) consumption on the machine generating the load test, which may affect the test plan execution and reduce the number of concurrent threads you may reach in your machine. In general, prefer using one of previously mentioned methods and use the dashboard just for local testing and quick feedback.</p> <p><strong>Remember removing it when is no longer needed in the test plan</strong></p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The test will not end until you close all pop up windows. This allows you to see the final charts and statistics of the plan before ending the test.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>As with <code>jtlWriter</code> and <code>influxDbListener</code>, you can place <code>dashboardVisualizer</code> at different levels of test plan (at test plan level, at thread group level, as child of sampler, etc.), to only capture statistics of that particular part of the test plan.</p></div> <h2 id="response-processing"><a href="#response-processing" class="header-anchor">#</a> Response Processing</h2> <h3 id="check-for-expected-response"><a href="#check-for-expected-response" class="header-anchor">#</a> Check for expected response</h3> <p>By default, JMeter marks any HTTP request with a fail response code (4xx or 5xx) as failed, which allows you to easily identify when some request unexpectedly fails. But in many cases this is not enough or desirable, and you need to check for response body (or some other field) to contain (or not) certain string.</p> <p>This is usually accomplished in JMeter with the usage of Response Assertions, which provides an easy and fast way to verify that you get the proper response for each step of the test plan, marking the request as failure when specified condition is not met.</p> <p>Here is an example on how to specify a response assertion in jmeter-java-dsl:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">responseAssertion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">containsSubstrings</span><span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/assertions/DslResponseAssertion.java" target="_blank" rel="noopener noreferrer">Response Assertion<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details and additional options.</p> <p>For more complex scenarios check <a href="#change-sample-result-statuses-with-custom-logic">following section</a>.</p> <h3 id="change-sample-result-statuses-with-custom-logic"><a href="#change-sample-result-statuses-with-custom-logic" class="header-anchor">#</a> Change sample result statuses with custom logic</h3> <p>Sometimes <a href="#check-for-expected-response">response assertions</a> and JMeter default behavior are not enough, and custom logic is required. In such scenarios you can use <code>jsr223PostProcessor</code> as in this example where 429 status code is not considered as a fail status code:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span><span class="token string">&quot;if (prev.responseCode == '429') { prev.successful = true }&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>You can also use a Java lambda instead of providing Groovy script, which benefits from Java type safety &amp; IDEs code auto-completion:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">jsr223PostProcessor</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> 
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;429&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    s<span class="token punctuation">.</span>prev<span class="token punctuation">.</span><span class="token function">setSuccessful</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Using this last approach is currently only supported when using embedded JMeter engine (no support for saving to JMX and running it in JMeter GUI, or running it with BlazeMeter).</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslJsr223PostProcessor.java" target="_blank" rel="noopener noreferrer">DslJsr223PostProcessor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details and additional options.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>JSR223PostProcessor is a very powerful tool, but is not the only, nor the best, alternative for many cases where JMeter already provides a better and simpler alternative. For instance, previously mentioned might be implemented with previously presented <a href="#check-for-expected-response">Response Assertion</a>.</p></div> <h3 id="use-part-of-a-response-in-a-following-request-aka-correlation"><a href="#use-part-of-a-response-in-a-following-request-aka-correlation" class="header-anchor">#</a> Use part of a response in a following request (aka: correlation)</h3> <p>It is a usual requirement while creating a test plan for an application to be able to use part of a response (e.g.: a generated ID, token, etc.) in a subsequent request. This can be easily achieved using JMeter extractors and variables.</p> <h4 id="regular-expression-extractor"><a href="#regular-expression-extractor" class="header-anchor">#</a> Regular Expression Extractor</h4> <p>Here is an example with jmeter-java-dsl using regular expressions:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslRegexExtractor.java" target="_blank" rel="noopener noreferrer">DslRegexExtractor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details and additional options.</p> <h4 id="boundary-extractors"><a href="#boundary-extractors" class="header-anchor">#</a> Boundary Extractors</h4> <p>Regular expressions are quite powerful and flexible, but also are complex and performance might not be optimal in some scenarios. When you know that desired extraction is always surrounded by some specific text that never varies, then you can use <code>boundaryExtractor</code> which is simpler and in many cases more performant:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">boundaryExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/postprocessors/DslBoundaryExtractor.java" target="_blank" rel="noopener noreferrer">DslBoundaryExtractor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details and additional options.</p> <h4 id="json-extractor"><a href="#json-extractor" class="header-anchor">#</a> JSON Extractor</h4> <p>When the response of a request is JSON, then you can use <code>jsonExtractor</code> by using <a href="https://jmespath.org/" target="_blank" rel="noopener noreferrer">JMESPath query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">jsonExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Be aware that this element uses JMeter JSON JMESPath Extractor element, and not the JMeter JSON Extractor element. This means that uses JMESPath instead of JSON Path.</p></div> <h2 id="requests-generation"><a href="#requests-generation" class="header-anchor">#</a> Requests generation</h2> <h3 id="conditionals"><a href="#conditionals" class="header-anchor">#</a> Conditionals</h3> <p>At some point, you will need to execute part of a test plan according to certain condition (eg: a value extracted from previous request). When you reach such point, you can use <code>ifController</code> like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">ifController</span><span class="token punctuation">(</span><span class="token string">&quot;${__groovy(vars['ACCOUNT_ID'] != null)}&quot;</span><span class="token punctuation">,</span> 
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>You can also use a Java lambda instead of providing JMeter expression, which benefits from Java type safety &amp; IDEs code auto-completion:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">ifController</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts/${ACCOUNT_ID}&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Using java code (lambdas) will only work with embedded JMeter engine (no support for saving to JMX and running it in JMeter GUI, or running it with BlazeMeter). Use the first option to avoid such limitations.</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslIfController.java" target="_blank" rel="noopener noreferrer">DslIfController<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://jmeter.apache.org/usermanual/component_reference.html#If_Controller" target="_blank" rel="noopener noreferrer">JMeter Component documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <h3 id="loops"><a href="#loops" class="header-anchor">#</a> Loops</h3> <h4 id="while-controller"><a href="#while-controller" class="header-anchor">#</a> While Controller</h4> <p>If at any time you want to execute a given part of a test plan, inside a thread iteration, while a condition is met, then you can use <code>whileController</code> (internally using <a href="https://jmeter.apache.org/usermanual/component_reference.html#While_Controller" target="_blank" rel="noopener noreferrer">JMeter While Controller<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> 
        <span class="token function">whileController</span><span class="token punctuation">(</span><span class="token string">&quot;${__groovy(vars['ACCOUNT_ID'] == null)}&quot;</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
                <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>As with <code>ifController</code>, you can also use Java lambdas to benefit from IDE auto-completion and type safety. Eg:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">whileController</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;John Doe\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
        <span class="token function">regexExtractor</span><span class="token punctuation">(</span><span class="token string">&quot;ACCOUNT_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\&quot;id\&quot;:\&quot;([^\&quot;]+)\&quot;&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Using java code (lambdas) will only work with embedded JMeter engine (no support for saving to JMX and running it in JMeter GUI, or running it with BlazeMeter). Use the first option to avoid such limitations.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>JMeter evaluates while conditions before entering each iteration, and after exiting each iteration. Take this into consideration if the condition has side effects (eg: incrementing counters, altering some other state, etc).</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>JMeter automatically generates a variable <code>__jm__&lt;loopName&gt;__idx</code> with the current index of while iteration (starting with 0). Example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">whileController</span><span class="token punctuation">(</span><span class="token string">&quot;items&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;${__groovy(vars.getObject('__jm__items__idx') &lt; 4)}&quot;</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;name\&quot;: \&quot;My Item\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Default name for while controller, when not specified, is <code>while</code>.</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/DslWhileController.java" target="_blank" rel="noopener noreferrer">DslWhileController<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <h4 id="for-loop-controller"><a href="#for-loop-controller" class="header-anchor">#</a> For Loop Controller</h4> <p>In simple scenarios where you just want to execute a fixed number of times, within a thread group iteration, a given part of the test plan, you can just use <code>forLoopController</code> (which uses <a href="https://jmeter.apache.org/usermanual/component_reference.html#Loop_Controller" target="_blank" rel="noopener noreferrer">JMeter Loop Controller component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) as in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> 
        <span class="token function">forLoopController</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/accounts&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>This will result in 10 * 5 = 50 requests to the given URL for each thread in the thread group.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>JMeter automatically generates a variable <code>__jm__&lt;loopName&gt;__idx</code> with the current index of while iteration (starting with 0) which you can use in children elements.</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/ForLoopController.java" target="_blank" rel="noopener noreferrer">ForLoopController<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <h3 id="provide-request-parameters-programmatically-per-request"><a href="#provide-request-parameters-programmatically-per-request" class="header-anchor">#</a> Provide Request Parameters Programmatically per Request</h3> <p>With the standard DSL you can provide static values to request parameters, such as a body. However, you may also want to be able to modify your requests for each call. This is common in cases where your request creates something that must have unique values.</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span><span class="token class-name">JMeterVariables</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;${REQUEST_BODY}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span>
            <span class="token function">jsr223PreProcessor</span><span class="token punctuation">(</span><span class="token string">&quot;vars.put('REQUEST_BODY', &quot;</span> <span class="token operator">+</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;.buildRequestBody(vars))&quot;</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span><span class="token class-name">JMeterVariables</span> vars<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> countVarName <span class="token operator">=</span> <span class="token string">&quot;REQUEST_COUNT&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> countVar <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> vars<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>countVarName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> countVar <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> countVar <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
    vars<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>countVarName<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;MyBody&quot;</span> <span class="token operator">+</span> count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>You can also use a Java lambda instead of providing Groovy script, which benefits from Java type safety &amp; IDEs code auto-completion:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">jsr223PreProcessor</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span>vars<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;REQUEST_BODY&quot;</span><span class="token punctuation">,</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Or even use this shorthand:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">post</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Using java code (lambdas) will only work with embedded JMeter engine (no support for saving to JMX and running it in JMeter GUI, or running it with BlazeMeter). Use the first option to avoid such limitations.</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/preprocessors/DslJsr223PreProcessor.java" target="_blank" rel="noopener noreferrer">DslJsr223PreProcessor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> &amp; <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/http/DslHttpSampler.java" target="_blank" rel="noopener noreferrer">DslHttpSampler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details and additional options.</p> <h3 id="csv-as-input-data-for-requests"><a href="#csv-as-input-data-for-requests" class="header-anchor">#</a> CSV as input data for requests</h3> <p>Sometimes is necessary to run same flow but using different but pre-defined data on each request. For example, a common use case is using a different user (from a given set) in each request.</p> <p>This can be easily achieved using provided <code>csvDataSet</code> element. For example, having a file like this one:</p> <div class="language-csv line-numbers-mode"><pre class="language-csv"><code><span class="token value">USER</span><span class="token punctuation">,</span><span class="token value">PASS</span>
<span class="token value">user1</span><span class="token punctuation">,</span><span class="token value">pass1</span>
<span class="token value">user2</span><span class="token punctuation">,</span><span class="token value">pass2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>You can implement a test plan which test recurrent login with the two users with something like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpMethod</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">csvDataSet</span><span class="token punctuation">(</span><span class="token string">&quot;users.csv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/login&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;${USER}\&quot;: \&quot;${PASS}\&quot;&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/logout&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>By default the CSV file will be opened once and shared by all threads. This means that when one thread reads a CSV line in one iteration, then the following thread reading a line will continue for the following line.</p> <p>If you want to change this (to only share file per thread group, or using one file per thread), then you can use provided sharedIn method like in followin example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span>configs<span class="token punctuation">.</span></span><span class="token class-name">DslCsvDataSet<span class="token punctuation">.</span>Sharing</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token class-name">TestPlanStats</span> stats<span class="token operator">=</span><span class="token function">testPlan</span><span class="token punctuation">(</span>
    <span class="token function">csvDataSet</span><span class="token punctuation">(</span><span class="token string">&quot;users.csv&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sharedIn</span><span class="token punctuation">(</span><span class="token class-name">Sharing</span><span class="token punctuation">.</span>THREAD<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/login&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;${USER}\&quot;: \&quot;${PASS}\&quot;&quot;</span><span class="token punctuation">,</span><span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/logout&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/configs/DslCsvDataSet.java" target="_blank" rel="noopener noreferrer">DslCsvDataSet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional details and options (like changing delimiter, handling files without headers line, stopping on end of file, etc.).</p> <h3 id="group-requests"><a href="#group-requests" class="header-anchor">#</a> Group requests</h3> <p>Sometimes, is necessary to be able to group requests which constitute different steps in a test. For example, to separate necessary requests to do a login from the ones used to add items to the cart and the ones to do a purchase. JMeter (and the DSL) provide Transaction Controllers for this purpose, here is an example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaveTestPlanAsJMX</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/login&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;user=test&amp;password=test&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>FORM_ENCODED<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'addItemToCart'</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/items&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;id\&quot;: 1}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>  
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>This will provide additional sample results for each transaction, which contain the aggregate metrics for containing requests, allowing to focus on the actual flow steps instead of each particular request.</p> <h3 id="emulate-user-delays-between-requests"><a href="#emulate-user-delays-between-requests" class="header-anchor">#</a> Emulate user delays between requests</h3> <p>Sometimes, is necessary to replicate users' behavior on the test plan, adding a timer between requests is one of the most used practices. For example, simulate the time it will take to complete a purchase form. JMeter (and the DSL) provide Uniform Random Timer for this purpose. Here is an example that adds a delay between four and ten seconds:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>eclipse<span class="token punctuation">.</span>jetty<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MimeTypes<span class="token punctuation">.</span>Type</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTransactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'addItemToCart'</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/items&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;id\&quot;: 1}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>  
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">'chekcout'</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/chekout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">uniformRandomTimer</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/checkout/userinfo&quot;</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;Name\&quot;: Dave, \&quot;lastname\&quot;: Tester, \&quot;Street\&quot;: 1483  Smith Road, \&quot;City\&quot;: Atlanta}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Timers apply to all samplers in their scope, adding a pause after pre-processors executions and before the actual sampling. For example, in previous example pauses would be added before checkout and also before user info (two pauses).</p> <p>If you want to apply a timer only to one sampler, add it as child of the given sampler. Like in this example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/cart/chekout&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token function">uniformRandomTimer</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><code>uniformRandomTimer</code> <code>minimumMillis</code> and <code>maximumMillis</code> parameters differ from the ones used by JMeter Uniform Random Timer element, to make it simpler to users with no JMeter background.</p> <p>The generated JMeter test element uses as <code>Constant Delay Offset</code> the <code>minimumMillis</code> value, and as <code>Maximum random delay</code> <code>(maximumMillis - minimumMillis)</code> value.</p></div> <h3 id="execute-test-plan-part-for-a-fraction-of-times"><a href="#execute-test-plan-part-for-a-fraction-of-times" class="header-anchor">#</a> Execute test plan part for a fraction of times</h3> <p>In some cases, you may want to execute a given part of the test plan not in every iteration and only for a given percent of the times to emulate certain probabilistic nature of the flow the users execute.</p> <p>In such scenarios you may use <code>percentController</code>, which uses JMeter Throughput Controller to achieve exactly that.</p> <p>Here is an example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">percentController</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token comment">// run this 40% of the times</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/poll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token function">percentController</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token comment">// run this 70% of the times</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/items&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/core/controllers/PercentController.java" target="_blank" rel="noopener noreferrer">PercentController<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details.</p> <h3 id="parallel-requests"><a href="#parallel-requests" class="header-anchor">#</a> Parallel requests</h3> <p>JMeter provides two main ways for running requests in parallel: thread groups and http samplers downloading embedded resources in parallel. But in some cases is necessary to run requests in parallel which can't be properly modeled with previously mentioned scenarios. For such cases you can use <code>paralleController</code> which allows using the <a href="https://github.com/Blazemeter/jmeter-bzm-plugins/blob/master/parallel/Parallel.md" target="_blank" rel="noopener noreferrer">Parallel Controller plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to execute a given set of requests in parallel (while in a JMeter thread iteration step).</p> <p>To use it, add following dependency to your project:</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>us.abstracta.jmeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jmeter-java-parallel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>testImplementation <span class="token string">'us.abstracta.jmeter:jmeter-java-dsl-dashboard:0.33'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div></div> <p>And use it like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>parallel<span class="token punctuation">.</span></span><span class="token class-name">ParallelController</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">parallelController</span><span class="token punctuation">(</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/poll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>By default the controller has no limit on the number of parallel requests per JMeter thread. You can set a limit by using provided <code>maxThreads(int)</code> method. Additionally, you can opt to aggregate children results in a parent sampler using <code>generateParentSample(boolean)</code> method, in similar fashion to transaction controller.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When requesting embedded resources of an HTML response, prefer using <code>downloadEmbeddedResources(boolean)</code> method in <code>httpSampler</code> instead. Likewise, when you just need independent parts of a test plan to execute in parallel, prefer using different thread group for each part.</p></div> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl-parallel/src/main/java/us/abstracta/jmeter/javadsl/parallel/ParallelController.java" target="_blank" rel="noopener noreferrer">ParallelController<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional info.</p> <h2 id="protocols"><a href="#protocols" class="header-anchor">#</a> Protocols</h2> <h3 id="http-performance-testing"><a href="#http-performance-testing" class="header-anchor">#</a> HTTP performance testing</h3> <p>Throughout this guide, several examples have been shown for simple cases of HTTP requests (mainly how to do gets and posts), but the DSL provides additional features that you might need to be aware.</p> <p>Here we show some of them, but check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/JmeterDsl.java" target="_blank" rel="noopener noreferrer">JmeterDsl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/http/DslHttpSampler.java" target="_blank" rel="noopener noreferrer">DslHttpSampler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to explore all available features.</p> <h4 id="methods-body"><a href="#methods-body" class="header-anchor">#</a> Methods &amp; body</h4> <p>As previously seen you can do simple gets and post like in following snippet:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span> <span class="token comment">// A simple get</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;field\&quot;:\&quot;val\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span> <span class="token comment">// simple post</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>But you can also use additional methods to specify any HTTP method and body:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>PUT<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;field\&quot;:\&quot;val\&quot;}&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>When in need to generate dynamic URLs or bodies you can use a lambda expressions (as previously seen in some example):</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>TEXT_PLAIN<span class="token punctuation">)</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestBody</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token function">buildRequestUrl</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>vars<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>As previously mentioned for other lambdas, using them will only work with embedded JMeter engine. So, prefer using <a href="#provide-request-parameters-programmatically-per-request">JSR223 pre processors</a> with groovy script instead if you want to be able to run the test at scale or use generated JMX.</p></div> <h4 id="headers"><a href="#headers" class="header-anchor">#</a> Headers</h4> <p>You might have already noticed in some of the examples that we have shown already some ways to set some headers. For instance, in following snippet <code>Content-Type</code> header is being set in two different ways:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;field\&quot;:\&quot;val\&quot;}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
<span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">Type</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>These are handy methods to specify <code>Content-Type</code> header, but you can also set any header on a particular request using provided <code>header</code> method, like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-First-Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;val1&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-Second-Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;val2&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Additionally, you can specify headers to be used by all samplers in a test plan, thread group, transaction controllers, etc. For this you can use <code>httpHeaders</code> like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
  <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token function">httpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;X-Header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;val1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/users&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can also use lambda expressions for dynamically building HTTP Headers, but same limitations apply as in other cases (running in BlazeMeter or using generated JMX file).</p></div> <h4 id="cookies-caching"><a href="#cookies-caching" class="header-anchor">#</a> Cookies &amp; Caching</h4> <p>jmeter-java-dsl automatically adds a cookie manager and cache manager for automatic HTTP cookie and caching handling, emulating browsers behavior. If you need to disable them you can use something like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">testPlan</span><span class="token punctuation">(</span>
  <span class="token function">httpCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">httpCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="embedded-resources"><a href="#embedded-resources" class="header-anchor">#</a> Embedded resources</h4> <p>Sometimes you may need to reproduce browsers behavior, downloading for a given URL all associated resources (images, frames, etc.).</p> <p>jmeter-java-dsl allows you to easily reproduce this scenario by using the <code>downloadEmbeddedResources</code> method in <code>httpSampler</code> like in following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PerformanceTest</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service/&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">downloadEmbeddedResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>This will make JMeter to automatically parse the HTTP response for embedded resources, download them and register embedded resources downloads as sub samples of the main sample.</p> <p>Check <a href="https://jmeter.apache.org/usermanual/component_reference.html#HTTP_Request" target="_blank" rel="noopener noreferrer">JMeter documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for additional details on downloaded embedded resources.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The DSL, unlike JMeter, uses by default concurrent download of embedded resources (with up to 6 parallel downloads), which is the most used scenario to emulate browsers behavior.</p></div> <h4 id="redirects"><a href="#redirects" class="header-anchor">#</a> Redirects</h4> <p>When jmeter-java-dsl (using JMeter logic) detects a redirection, it will automatically do a request to the redirected URL and register the redirection as a sub sample of the main request.</p> <p>If you want to disable such logic, you can just call <code>.followRedirects(false)</code> in a given <code>httpSampler</code>.</p> <h3 id="java-api-performance-testing"><a href="#java-api-performance-testing" class="header-anchor">#</a> Java API performance testing</h3> <p>Sometimes JMeter provided samplers are not enough for testing a particular technology, custom code or service that requires some custom code to interact with. For these cases you might use <code>jsr223Sampler</code> which allows you to use custom logic to generate a sample result.</p> <p>Here is an example for load testing a redis server:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestRedis</span> <span class="token punctuation">{</span>

  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldGetExpectedSampleResultWhenJsr223SamplerWithLambdaAndCustomResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token function">testPlan</span><span class="token punctuation">(</span>
        <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
            <span class="token function">jsr223Sampler</span><span class="token punctuation">(</span><span class="token string">&quot;import redis.clients.jedis.Jedis\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;Jedis jedis = new Jedis('localhost', 6379)\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;jedis.connect()\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;SampleResult.connectEnd()\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;jedis.set('foo', 'bar')\n&quot;</span>
                <span class="token operator">+</span> <span class="token string">&quot;return jedis.get(\&quot;foo\&quot;)&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Remember adding any particular dependencies required by your code. For example, above example requires this dependency:</p> <div class="el-tabs el-tabs--card el-tabs--top"><div class="el-tabs__header is-top"><div class="el-tabs__nav-wrap is-top"><div class="el-tabs__nav-scroll"><div role="tablist" class="el-tabs__nav is-top" style="transform:translateX(-0px);"></div></div></div></div><div class="el-tabs__content"><div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <div role="tabpanel" aria-hidden="true" id="pane-null" aria-labelledby="tab-null" class="el-tab-pane" style="display:none;"><div class="language-groovy line-numbers-mode"><pre class="language-groovy"><code>testImplementation <span class="token string">'redis.clients:jedis:3.6.0'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div></div></div></div> <p>You can also use Java lambdas instead of Groovy script to take advantage of IDEs auto-completion and Java type safety:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">jsr223Sampler</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
  <span class="token class-name">SampleResult</span> result <span class="token operator">=</span> v<span class="token punctuation">.</span>sampleResult<span class="token punctuation">;</span>
  <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  jedis<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  result<span class="token punctuation">.</span><span class="token function">connectEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  result<span class="token punctuation">.</span><span class="token function">setResponseData</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Using java code (lambdas) will only work with embedded JMeter engine (no support for saving to JMX and running it in JMeter GUI, or running it with BlazeMeter). Use the first option to avoid such limitations.</p></div> <p><code>jsr223Sampler</code> is very powerful, but also makes code and test plan harder to maintain (as with any custom code) compared to using JMeter built-in samplers. So, in general, prefer using JMeter provided samplers if they are enough for the task at hand, and use <code>jsr223Sampler</code> sparingly.</p> <p>Check <a href="https://github.com/abstracta/jmeter-java-dsl/tree/master/jmeter-java-dsl/src/main/java/us/abstracta/jmeter/javadsl/java/DslJsr223Sampler.java" target="_blank" rel="noopener noreferrer">DslJsr223Sampler<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details and additional options.</p> <h2 id="jmx-support"><a href="#jmx-support" class="header-anchor">#</a> JMX support</h2> <h3 id="save-as-jmx"><a href="#save-as-jmx" class="header-anchor">#</a> Save as JMX</h3> <p>In case you want to load a test plan in JMeter GUI, you can save it just invoking <code>saveAsJMX</code> method in the test plan as in the following example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span></span><span class="token class-name">JmeterDsl</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaveTestPlanAsJMX</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token function">testPlan</span><span class="token punctuation">(</span>
      <span class="token function">threadGroup</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token function">httpSampler</span><span class="token punctuation">(</span><span class="token string">&quot;http://my.service&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">saveAsJmx</span><span class="token punctuation">(</span><span class="token string">&quot;dsl-test-plan.jmx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>This can be helpful to share a Java DSL defined test plan with people not used to the DSL, or to use some JMeter feature (or plugin) that is not yet supported by the DSL (<strong>but, we strongly encourage you to report it as an issue <a href="https://github.com/abstracta/jmeter-java-dsl/issues" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> so we can include such support into the DSL for the rest of the community).</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Take into consideration that currently there is no automatic way to migrate changes done in JMX to the Java DSL.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If you use JSR223 Pre- or Post- processors with Java code (lambdas) instead of strings, or use one of the HTTP Sampler methods which receive a function as parameter, then the exported JMX will not work in JMeter GUI. You can migrate them to use jsrPreProcessor with string scripts instead.</p></div> <h3 id="run-jmx-file"><a href="#run-jmx-file" class="header-anchor">#</a> Run JMX file</h3> <p>jmeter-java-dsl also provides means to easily run a test plan from a JMX file either locally or in BlazeMeter (through <a href="#run-test-at-scale-in-blazemeter">previously mentioned jmeter-java-dsl-blazemeter module</a>). Here is an example:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">DslTestPlan</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">us<span class="token punctuation">.</span>abstracta<span class="token punctuation">.</span>jmeter<span class="token punctuation">.</span>javadsl<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">TestPlanStats</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunJmxTestPlan</span> <span class="token punctuation">{</span>
  
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">TestPlanStats</span> stats <span class="token operator">=</span> <span class="token class-name">DslTestPlan</span><span class="token punctuation">.</span><span class="token function">fromJmx</span><span class="token punctuation">(</span><span class="token string">&quot;test-plan.jmx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assertThat</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">overall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sampleTimePercentile99</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isLessThan</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>This can be used to just run existing JMX files, or when DSL has no support for some JMeter functionality or plugin, and you need to use JMeter GUI to build the test plan but still want to use jmeter-java-dsl to run the test plan embedded in Java test or code.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>When the JMX uses some custom plugin or JMeter protocol support, you might need to add required dependencies to be able to run the test in an embedded engine. For example, when running a TN3270 JMX test plan using RTE plugin you will need to add the following repository and dependencies:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>jitpack.io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://jitpack.io<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
   ...
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.Blazemeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>RTEPlugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.Blazemeter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dm3270<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.12.3-lib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/jmeter-java-dsl/assets/js/app.a80c093b.js" defer></script><script src="/jmeter-java-dsl/assets/js/2.116f2a4a.js" defer></script><script src="/jmeter-java-dsl/assets/js/4.cafc48df.js" defer></script><script src="/jmeter-java-dsl/assets/js/3.c35124cc.js" defer></script>
  </body>
</html>
